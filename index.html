<script>
    async function mergePDFs() {
        console.log("Merge button clicked");

        const input = document.getElementById("pdfInput");
        if (input.files.length < 2) {
            alert("Please select at least two PDFs to merge.");
            console.error("Not enough PDFs selected");
            return;
        }

        console.log("Creating new PDF document...");
        const pdfDoc = await PDFLib.PDFDocument.create();

        for (const file of input.files) {
            console.log("Reading file:", file.name);
            const reader = new FileReader();
            reader.readAsArrayBuffer(file);
            await new Promise(resolve => reader.onload = resolve);

            console.log("Loading PDF...");
            const existingPdf = await PDFLib.PDFDocument.load(reader.result);
            const copiedPages = await pdfDoc.copyPages(existingPdf, existingPdf.getPageIndices());
            copiedPages.forEach(page => pdfDoc.addPage(page));
        }

        console.log("Saving merged PDF...");
        const mergedPdfBytes = await pdfDoc.save();
        const blob = new Blob([mergedPdfBytes], { type: "application/pdf" });

        console.log("Creating download link...");
        const link = document.getElementById("downloadLink");
        link.href = URL.createObjectURL(blob);
        link.style.display = "block";
        link.textContent = "Download Merged PDF";

        console.log("Merge complete!");
    }
</script>

